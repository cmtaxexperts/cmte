<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>CMbooks - Business Manager</title>
    <link rel="icon" type="image/png" href="logocmbooks.png">
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        /* --- CORE THEME: RED & GREY [3] --- */
        :root {
            --primary: #1e293b; /* Slate 800 */
            --accent: #b91c1c;   /* CM Red */
            --accent-dark: #991b1b; /* Darker Red */
            --bg-light: #f8fafc; /* Slate 50 */
        }
        body { font-family: 'Inter', system-ui, -apple-system, sans-serif; background-color: var(--bg-light); color: var(--primary); }
        
        /* Login Gradient - Red Theme [3] */
        .login-bg { background: linear-gradient(135deg, var(--accent-dark) 0%, var(--accent) 100%); }
        
        /* Utilities */
        .card-hover { transition: transform 0.2s, box-shadow 0.2s; }
        .card-hover:active { transform: scale(0.98); }
        .hide-scrollbar::-webkit-scrollbar { display: none; }
        /* Red Loader [3] */
        .loader { width: 20px; height: 20px; border: 2px solid #e2e8f0; border-top-color: var(--accent); border-radius: 50%; animation: spin 0.8s linear infinite; }
        @keyframes spin { to { transform: rotate(360deg); } }
        
        /* Transitions */
        .fade-in { animation: fadeIn 0.3s ease-in-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* Buttons */
        .btn-red { @apply bg-red-700 hover:bg-red-800 text-white font-bold shadow-sm transition; }
        .btn-outline { @apply bg-white border border-gray-200 text-slate-700 font-bold shadow-sm hover:bg-gray-50 transition; }
    </style>
</head>
<body class="h-screen overflow-hidden flex flex-col">

    <div id="view-login" class="fixed inset-0 z-50 login-bg flex items-center justify-center p-4">
        <div class="bg-white rounded-2xl shadow-2xl p-8 w-full max-w-sm text-center">
            <div class="w-20 h-20 mx-auto flex items-center justify-center mb-4">
                <img src="logocmbooks.png" class="w-full h-full object-contain" alt="CMbooks Logo">
            </div>
            <h1 class="text-2xl font-bold text-slate-800 mb-1">CMbooks</h1>
            <p class="text-xs text-slate-400 mb-8 uppercase tracking-widest">Professional Workspace</p>
            
            <form onsubmit="app.login(event)" class="space-y-4">
                <div class="relative">
                    <i class="fas fa-user absolute left-3 top-3.5 text-gray-400"></i>
                    <input type="text" id="user" class="w-full pl-10 pr-4 py-3 bg-gray-50 border border-gray-200 rounded-xl text-sm focus:outline-none focus:border-red-700 transition" placeholder="Username" required>
                </div>
                <div class="relative">
                    <i class="fas fa-lock absolute left-3 top-3.5 text-gray-400"></i>
                    <input type="password" id="pass" class="w-full pl-10 pr-4 py-3 bg-gray-50 border border-gray-200 rounded-xl text-sm focus:outline-none focus:border-red-700 transition" placeholder="Password" required>
                </div>
                <button type="submit" class="w-full btn-red py-3 rounded-xl text-sm">
                    Login
                </button>
            </form>
            <p id="login-msg" class="text-red-600 text-xs mt-3 hidden font-semibold">Invalid Credentials</p>
        </div>
    </div>

    <div id="view-app" class="hidden flex-col h-full">
        
        <header class="bg-white border-b border-gray-200 h-16 flex items-center justify-between px-4 z-40 shrink-0">
            <div class="flex items-center gap-3 cursor-pointer" onclick="app.nav('dashboard')">
                <img src="logocmbooks.png" class="w-10 h-10 object-contain">
                <div>
                    <h2 class="text-lg font-bold text-slate-800 leading-tight">CMbooks</h2>
                    <p id="page-title" class="text-[10px] text-red-700 font-bold uppercase tracking-wider">Dashboard</p>
                </div>
            </div>
            <button onclick="app.logout()" class="w-8 h-8 flex items-center justify-center rounded-full hover:bg-gray-100 text-slate-400 transition" title="Logout">
                <i class="fas fa-power-off"></i>
            </button>
        </header>

        <main class="flex-grow overflow-y-auto relative bg-slate-50 hide-scrollbar p-4">
            
            <div id="mod-dashboard" class="fade-in max-w-5xl mx-auto pt-6">
                <div class="grid grid-cols-2 md:grid-cols-3 gap-6">
                    <div onclick="app.nav('clients')" class="card-hover bg-white p-6 rounded-2xl shadow-sm border border-slate-100 cursor-pointer flex flex-col items-center justify-center gap-4 h-40">
                        <div class="w-14 h-14 rounded-full bg-red-50 text-red-700 flex items-center justify-center text-2xl"><i class="fas fa-users"></i></div>
                        <span class="font-bold text-slate-700">Client Data</span>
                    </div>
                    <div onclick="app.nav('accounts')" class="card-hover bg-white p-6 rounded-2xl shadow-sm border border-slate-100 cursor-pointer flex flex-col items-center justify-center gap-4 h-40">
                        <div class="w-14 h-14 rounded-full bg-red-50 text-red-700 flex items-center justify-center text-2xl"><i class="fas fa-calculator"></i></div>
                        <span class="font-bold text-slate-700">Accounts</span>
                    </div>
                    <div onclick="app.nav('compliance')" class="card-hover bg-white p-6 rounded-2xl shadow-sm border border-slate-100 cursor-pointer flex flex-col items-center justify-center gap-4 h-40">
                        <div class="w-14 h-14 rounded-full bg-red-50 text-red-700 flex items-center justify-center text-2xl"><i class="fas fa-file-contract"></i></div>
                        <span class="font-bold text-slate-700">Compliance</span>
                    </div>
                    <div onclick="app.nav('invoice')" class="card-hover bg-white p-6 rounded-2xl shadow-sm border border-slate-100 cursor-pointer flex flex-col items-center justify-center gap-4 h-40">
                        <div class="w-14 h-14 rounded-full bg-red-50 text-red-700 flex items-center justify-center text-2xl"><i class="fas fa-file-invoice-dollar"></i></div>
                        <span class="font-bold text-slate-700">Invoice</span>
                    </div>
                    <div onclick="app.nav('credentials')" class="card-hover bg-white p-6 rounded-2xl shadow-sm border border-slate-100 cursor-pointer flex flex-col items-center justify-center gap-4 h-40">
                        <div class="w-14 h-14 rounded-full bg-red-50 text-red-700 flex items-center justify-center text-2xl"><i class="fas fa-key"></i></div>
                        <span class="font-bold text-slate-700">Credentials</span>
                    </div>
                     <div onclick="app.nav('payment')" class="card-hover bg-white p-6 rounded-2xl shadow-sm border border-slate-100 cursor-pointer flex flex-col items-center justify-center gap-4 h-40">
                        <div class="w-14 h-14 rounded-full bg-red-50 text-red-700 flex items-center justify-center text-2xl"><i class="fas fa-link"></i></div>
                        <span class="font-bold text-slate-700">Payment Link</span>
                    </div>
                </div>
            </div>

            <div id="mod-invoice" class="hidden fade-in h-full flex flex-col items-center justify-center">
                 <div class="max-w-2xl w-full space-y-8 text-center">
                    <h2 class="text-2xl font-bold text-slate-800">Invoice Management</h2>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <a href="https://docs.google.com/spreadsheets/d/1ZvjCfys0_XAcfM339HfB5_9X8TpBzt_3eP3dKzdLIMc/edit#gid=897038703" target="_blank" class="card-hover bg-white p-8 rounded-2xl shadow-sm border border-slate-100 cursor-pointer flex flex-col items-center justify-center gap-4 group">
                            <div class="w-16 h-16 rounded-full bg-red-50 text-red-700 group-hover:bg-red-700 group-hover:text-white transition flex items-center justify-center text-3xl"><i class="fas fa-plus"></i></div>
                            <span class="font-bold text-slate-700 text-lg">Add Invoice</span>
                            <span class="text-xs text-slate-400">(Opens Sheet Template)</span>
                        </a>
                        <div onclick="alert('Statement feature coming soon.')" class="card-hover bg-white p-8 rounded-2xl shadow-sm border border-slate-100 cursor-pointer flex flex-col items-center justify-center gap-4 opacity-60 grayscale">
                            <div class="w-16 h-16 rounded-full bg-gray-100 text-gray-500 flex items-center justify-center text-3xl"><i class="fas fa-list-alt"></i></div>
                            <span class="font-bold text-slate-700 text-lg">View Statement</span>
                             <span class="text-xs text-slate-400">(Coming Soon)</span>
                        </div>
                    </div>
                    <button onclick="app.nav('dashboard')" class="px-8 py-3 btn-outline rounded-xl text-sm">Go Back to Dashboard</button>
                 </div>
            </div>

            <div id="mod-clients" class="hidden fade-in h-full flex flex-col">
                <div class="flex flex-col md:flex-row gap-3 mb-4 sticky top-0 z-10 bg-slate-50 pb-2">
                    <div class="relative flex-grow">
                        <i class="fas fa-search absolute left-3 top-3 text-gray-400 text-xs"></i>
                        <input type="text" id="search-clients" placeholder="Search Clients..." class="w-full pl-9 pr-4 py-2 bg-white border border-gray-200 rounded-lg text-sm shadow-sm focus:outline-none focus:border-red-500">
                    </div>
                    <button onclick="clients.openModal('add')" class="btn-red px-4 py-2 rounded-lg text-sm">+ New Client</button>
                </div>
                <div class="bg-white rounded-xl shadow-sm border border-gray-200 flex-grow overflow-hidden relative">
                    <div class="absolute inset-0 overflow-auto">
                        <table class="w-full text-left border-collapse">
                            <thead class="bg-slate-50 text-xs font-bold text-slate-500 uppercase sticky top-0">
                                <tr>
                                    <th class="p-3 border-b">ID</th>
                                    <th class="p-3 border-b">Client Info</th>
                                    <th class="p-3 border-b hidden md:table-cell">Contact</th>
                                    <th class="p-3 border-b hidden md:table-cell">Tax Info</th>
                                    <th class="p-3 border-b text-center">Drive</th>
                                    <th class="p-3 border-b text-right">Edit</th>
                                </tr>
                            </thead>
                            <tbody id="table-clients" class="text-sm text-slate-700 divide-y divide-gray-100">
                                <tr><td colspan="6" class="p-8 text-center"><div class="inline-block loader"></div></td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <div id="mod-accounts" class="hidden fade-in h-full flex flex-col">
                <div class="grid grid-cols-3 gap-2 mb-4">
                    <div class="bg-white p-3 rounded-xl border-l-4 border-green-500 shadow-sm">
                        <p class="text-[10px] font-bold text-gray-400 uppercase">Income</p>
                        <p id="acc-inc" class="text-lg font-bold text-green-700">₹0</p>
                    </div>
                    <div class="bg-white p-3 rounded-xl border-l-4 border-red-500 shadow-sm">
                        <p class="text-[10px] font-bold text-gray-400 uppercase">Expense</p>
                        <p id="acc-exp" class="text-lg font-bold text-red-700">₹0</p>
                    </div>
                    <div class="bg-white p-3 rounded-xl border-l-4 border-blue-500 shadow-sm">
                        <p class="text-[10px] font-bold text-gray-400 uppercase">Balance</p>
                        <p id="acc-bal" class="text-lg font-bold text-slate-800">₹0</p>
                    </div>
                </div>
                <div class="flex gap-3 mb-4 sticky top-0 z-10 bg-slate-50 pb-2">
                    <div class="relative flex-grow">
                        <i class="fas fa-search absolute left-3 top-3 text-gray-400 text-xs"></i>
                        <input type="text" id="search-accounts" placeholder="Search..." class="w-full pl-9 pr-4 py-2 bg-white border border-gray-200 rounded-lg text-sm shadow-sm focus:outline-none focus:border-red-500">
                    </div>
                    <button onclick="accounts.openModal('add')" class="btn-red px-4 py-2 rounded-lg text-sm whitespace-nowrap">+ Entry</button>
                </div>
                <div class="bg-white rounded-xl shadow-sm border border-gray-200 flex-grow overflow-hidden relative">
                    <div class="absolute inset-0 overflow-auto">
                        <table class="w-full text-left border-collapse">
                            <thead class="bg-slate-50 text-xs font-bold text-slate-500 uppercase sticky top-0">
                                <tr>
                                    <th class="p-3 border-b">Date</th>
                                    <th class="p-3 border-b">Particulars</th>
                                    <th class="p-3 border-b text-right">Amount</th>
                                    <th class="p-3 border-b text-center">Doc</th>
                                    <th class="p-3 border-b text-right">Edit</th>
                                </tr>
                            </thead>
                            <tbody id="table-accounts" class="text-sm text-slate-700 divide-y divide-gray-100">
                                <tr><td colspan="5" class="p-8 text-center"><div class="inline-block loader"></div></td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <div id="mod-placeholder" class="hidden h-full flex items-center justify-center flex-col text-center opacity-60">
                <div class="w-20 h-20 bg-gray-100 rounded-full flex items-center justify-center mb-4 text-gray-400">
                    <i id="ph-icon" class="fas fa-tools text-4xl"></i>
                </div>
                <h3 id="ph-title" class="text-xl font-bold text-slate-700 mb-1">Module</h3>
                <p class="text-sm text-slate-400 mb-6">This module is under development.</p>
                <button onclick="app.nav('dashboard')" class="px-6 py-2 btn-outline rounded-lg text-sm">Go Back</button>
            </div>

        </main>
    </div>

    <div id="modal-client" class="fixed inset-0 z-50 hidden">
        <div class="absolute inset-0 bg-slate-900/40 backdrop-blur-sm" onclick="clients.closeModal()"></div>
        <div class="absolute bottom-0 md:top-1/2 md:left-1/2 md:-translate-x-1/2 md:-translate-y-1/2 w-full md:w-[600px] bg-white md:rounded-2xl rounded-t-2xl shadow-2xl flex flex-col max-h-[90vh]">
            <div class="px-5 py-3 border-b border-gray-100 flex justify-between items-center">
                <h3 class="font-bold text-slate-800" id="client-modal-title">Client Record</h3>
                <button onclick="clients.closeModal()" class="text-gray-400 hover:text-red-700"><i class="fas fa-times"></i></button>
            </div>
            <form id="form-client" class="p-5 overflow-y-auto space-y-3">
                <input type="hidden" id="c-rowIndex">
                <div class="grid grid-cols-3 gap-3">
                    <div class="col-span-1"><label class="text-[10px] font-bold text-gray-500 uppercase">ID</label><input type="text" id="Client_ID" name="Client_ID" class="w-full p-2 bg-red-50 border border-red-100 rounded text-xs font-mono font-bold text-red-700" readonly></div>
                    <div class="col-span-2"><label class="text-[10px] font-bold text-gray-500 uppercase">Name *</label><input type="text" id="Client_Name" name="Client_Name" class="w-full p-2 border rounded text-xs font-bold focus:border-red-500 outline-none" required></div>
                </div>
                <div class="grid grid-cols-2 gap-3">
                    <div><label class="text-[10px] font-bold text-gray-500 uppercase">Branch</label><select id="Branch" name="Branch" class="w-full p-2 border rounded text-xs bg-white"><option value="CMTE">CMTE</option><option value="ACT">ACT</option><option value="CMbooks">CMbooks</option></select></div>
                    <div><label class="text-[10px] font-bold text-gray-500 uppercase">Entity</label><select id="Constitution" name="Constitution" class="w-full p-2 border rounded text-xs bg-white"><option value="Individual">Individual</option><option value="Proprietorship">Proprietorship</option><option value="Partnership">Partnership</option><option value="LLP">LLP</option><option value="Private Limited">Pvt Ltd</option></select></div>
                </div>
                <div class="grid grid-cols-2 gap-3">
                    <div><label class="text-[10px] font-bold text-gray-500 uppercase">Mobile</label><input type="tel" id="Mobile_No" name="Mobile_No" class="w-full p-2 border rounded text-xs"></div>
                    <div><label class="text-[10px] font-bold text-gray-500 uppercase">Email</label><input type="email" id="Email" name="Email" class="w-full p-2 border rounded text-xs"></div>
                </div>
                <div class="grid grid-cols-3 gap-2 bg-gray-50 p-2 rounded border border-gray-100">
                    <div><label class="text-[10px] font-bold text-gray-500">PAN</label><input type="text" id="Pan_No" name="Pan_No" class="w-full p-1 border rounded text-xs uppercase font-mono"></div>
                    <div><label class="text-[10px] font-bold text-gray-500">GST</label><input type="text" id="GST_No" name="GST_No" class="w-full p-1 border rounded text-xs uppercase font-mono"></div>
                    <div><label class="text-[10px] font-bold text-gray-500">AADHAAR</label><input type="text" id="Adhar_No" name="Adhar_No" class="w-full p-1 border rounded text-xs font-mono"></div>
                </div>
                <div><label class="text-[10px] font-bold text-gray-500 uppercase">Address</label><textarea id="Address" name="Address" rows="2" class="w-full p-2 border rounded text-xs"></textarea></div>
                <div><label class="text-[10px] font-bold text-gray-500 uppercase">Drive Link</label><input type="url" id="Folder_Link" name="Folder_Link" class="w-full p-2 border rounded text-xs text-blue-600"></div>
                <input type="hidden" id="Reference" name="Reference"><input type="hidden" id="Legal_Name" name="Legal_Name"><input type="hidden" id="DOB" name="DOB"><input type="hidden" id="Notes" name="Notes">
                <button type="submit" id="c-save-btn" class="w-full py-3 btn-red rounded-xl text-sm mt-2">Save Client</button>
            </form>
        </div>
    </div>

    <div id="modal-account" class="fixed inset-0 z-50 hidden">
        <div class="absolute inset-0 bg-slate-900/40 backdrop-blur-sm" onclick="accounts.closeModal()"></div>
        <div class="absolute bottom-0 md:top-1/2 md:left-1/2 md:-translate-x-1/2 md:-translate-y-1/2 w-full md:w-[500px] bg-white md:rounded-2xl rounded-t-2xl shadow-2xl flex flex-col max-h-[90vh]">
            <div class="px-5 py-3 border-b border-gray-100 flex justify-between items-center">
                <h3 class="font-bold text-slate-800" id="acc-modal-title">Transaction Entry</h3>
                <button onclick="accounts.closeModal()" class="text-gray-400 hover:text-red-700"><i class="fas fa-times"></i></button>
            </div>
            <form id="form-account" class="p-5 overflow-y-auto space-y-3">
                <input type="hidden" id="a-rowIndex">
                <div class="grid grid-cols-2 gap-3">
                    <div><label class="text-[10px] font-bold text-gray-500 uppercase">Date</label><input type="date" id="Date" name="Date" class="w-full p-2 border rounded text-xs" required></div>
                    <div><label class="text-[10px] font-bold text-gray-500 uppercase">Type</label><select id="Txn_Type" name="Txn_Type" class="w-full p-2 border rounded text-xs"><option value="Income">Income (+)</option><option value="Expense">Expense (-)</option></select></div>
                </div>
                <div><label class="text-[10px] font-bold text-gray-500 uppercase">Particulars *</label><input type="text" id="Particulars" name="Particulars" class="w-full p-2 border rounded text-xs font-bold focus:border-red-500 outline-none" required></div>
                <div><label class="text-[10px] font-bold text-gray-500 uppercase">Client (Opt)</label><input type="text" id="a-Client_Name" name="Client_Name" class="w-full p-2 border rounded text-xs"></div>
                <div class="grid grid-cols-2 gap-3">
                    <div><label class="text-[10px] font-bold text-gray-500 uppercase">Category</label><select id="Category" name="Category" class="w-full p-2 border rounded text-xs bg-white"><option value="Professional Fees">Prof. Fees</option><option value="Govt Fees">Govt Fees</option><option value="Office Expense">Expense</option><option value="Salary">Salary</option><option value="Other">Other</option></select></div>
                    <div><label class="text-[10px] font-bold text-gray-500 uppercase">Amount *</label><input type="number" id="Amount" name="Amount" class="w-full p-2 border rounded text-xs font-bold text-slate-800" step="0.01" required></div>
                </div>
                <div class="grid grid-cols-2 gap-3">
                    <div><label class="text-[10px] font-bold text-gray-500 uppercase">Mode</label><select id="Payment_Mode" name="Payment_Mode" class="w-full p-2 border rounded text-xs bg-white"><option value="Cash">Cash</option><option value="UPI">UPI</option><option value="Bank">Bank</option></select></div>
                    <div><label class="text-[10px] font-bold text-gray-500 uppercase">Doc Link</label><input type="url" id="Doc_Link" name="Doc_Link" class="w-full p-2 border rounded text-xs text-blue-600"></div>
                </div>
                <input type="hidden" id="a-Notes" name="Notes">
                <button type="submit" id="a-save-btn" class="w-full py-3 btn-red rounded-xl text-sm mt-2">Save Transaction</button>
            </form>
        </div>
    </div>

    <script>
        // API CONFIGURATION
        const API_URL = "https://script.google.com/macros/s/AKfycbzgYb_qht1HHfKQRgHEua0kiE46NjrToJCPF8C6AxI9vD8AlqSkMVWzqXphWfXFVbk_/exec";

        // APP CONTROLLER
        const app = {
            login: (e) => {
                e.preventDefault();
                const u = document.getElementById('user').value;
                const p = document.getElementById('password').value;
                if(u === "cmeg1111" && p === "Cmeg@3655") {
                    document.getElementById('view-login').classList.add('hidden');
                    document.getElementById('view-app').classList.remove('hidden');
                    document.getElementById('view-app').classList.add('flex');
                } else {
                    document.getElementById('login-msg').classList.remove('hidden');
                }
            },
            logout: () => location.reload(),
            nav: (mod) => {
                const modules = ['dashboard', 'clients', 'accounts', 'compliance', 'invoice', 'credentials', 'payment', 'placeholder'];
                modules.forEach(m => {
                    const el = document.getElementById('mod-' + (['compliance','credentials', 'payment'].includes(m) ? 'placeholder' : m));
                    if(el) el.classList.add('hidden');
                });

                // Update Title & Navigation logic
                let title = mod.charAt(0).toUpperCase() + mod.slice(1);
                document.getElementById('page-title').innerText = title;

                if(['compliance', 'credentials', 'payment'].includes(mod)) {
                    document.getElementById('mod-placeholder').classList.remove('hidden');
                    document.getElementById('mod-placeholder').classList.add('flex');
                    document.getElementById('ph-title').innerText = title + " Module";
                    const icons = { compliance: 'fa-file-contract', credentials: 'fa-key', payment: 'fa-link' };
                    document.getElementById('ph-icon').className = `fas ${icons[mod]} text-5xl mb-4 text-gray-300`;
                } else {
                    document.getElementById('mod-' + mod).classList.remove('hidden');
                    if(mod === 'clients') clients.init();
                    if(mod === 'accounts') accounts.init();
                }
            }
        };

        // CLIENTS MODULE
        const clients = {
            data: [],
            nextId: "C40000",
            init: async () => {
                if(clients.data.length > 0) return;
                try {
                    const res = await fetch(API_URL + "?type=clients");
                    const json = await res.json();
                    clients.data = json.data;
                    clients.nextId = json.nextId;
                    clients.render(clients.data);
                } catch(e) { console.error(e); }
            },
            render: (list) => {
                const tbody = document.getElementById('table-clients');
                tbody.innerHTML = "";
                if(list.length === 0) { tbody.innerHTML = `<tr><td colspan="6" class="p-8 text-center text-gray-400">No records</td></tr>`; return; }
                
                list.reverse().forEach(c => {
                    const tr = document.createElement('tr');
                    tr.className = "hover:bg-red-50/30 border-b border-gray-100 last:border-0 transition";
                    tr.innerHTML = `
                        <td class="p-3 font-mono font-bold text-red-700 text-xs">${c.Client_ID}</td>
                        <td class="p-3">
                            <div class="font-bold text-slate-800">${c.Client_Name}</div>
                            <span class="text-[10px] bg-gray-100 px-1 rounded text-gray-500">${c.Branch || '-'}</span>
                        </td>
                        <td class="p-3 hidden md:table-cell text-xs text-slate-500">
                            <div>${c.Mobile_No || '-'}</div>
                            <div class="truncate w-24">${c.Email || ''}</div>
                        </td>
                        <td class="p-3 hidden md:table-cell text-xs font-mono text-slate-600">
                            ${c.GST_No ? `<div class="text-blue-700 font-bold">G: ${c.GST_No}</div>` : ''}
                            ${c.Pan_No ? `<div class="text-slate-700">P: ${c.Pan_No}</div>` : ''}
                        </td>
                        <td class="p-3 text-center">
                            ${c.Folder_Link ? `<a href="${c.Folder_Link}" target="_blank" class="text-green-600 hover:scale-110 inline-block transition"><i class="fab fa-google-drive text-lg"></i></a>` : '-'}
                        </td>
                        <td class="p-3 text-right">
                            <button onclick='clients.openModal("edit", ${JSON.stringify(c).replace(/'/g, "&#39;")})' class="text-gray-400 hover:text-red-700 transition"><i class="fas fa-edit"></i></button>
                        </td>
                    `;
                    tbody.appendChild(tr);
                });
            },
            openModal: (mode, data = null) => {
                document.getElementById('form-client').reset();
                document.getElementById('modal-client').classList.remove('hidden');
                if(mode === 'add') {
                    document.getElementById('client-modal-title').innerText = "New Client Entry";
                    document.getElementById('Client_ID').value = clients.nextId;
                    document.getElementById('c-rowIndex').value = "";
                } else {
                    document.getElementById('client-modal-title').innerText = "Edit Client Record";
                    document.getElementById('c-rowIndex').value = data.rowIndex;
                    Object.keys(data).forEach(k => { if(document.getElementById(k)) document.getElementById(k).value = data[k]; });
                }
            },
            closeModal: () => document.getElementById('modal-client').classList.add('hidden')
        };

        // ACCOUNTS MODULE
        const accounts = {
            data: [],
            init: async () => {
                if(accounts.data.length > 0) return;
                try {
                    const res = await fetch(API_URL + "?type=accounts");
                    const json = await res.json();
                    accounts.data = json.data;
                    accounts.updateSum(json.summary);
                    accounts.render(accounts.data);
                } catch(e) { console.error(e); }
            },
            updateSum: (s) => {
                if(!s) return;
                document.getElementById('acc-inc').innerText = `₹${s.income.toLocaleString()}`;
                document.getElementById('acc-exp').innerText = `₹${s.expense.toLocaleString()}`;
                document.getElementById('acc-bal').innerText = `₹${s.balance.toLocaleString()}`;
            },
            render: (list) => {
                const tbody = document.getElementById('table-accounts');
                tbody.innerHTML = "";
                if(list.length === 0) { tbody.innerHTML = `<tr><td colspan="5" class="p-8 text-center text-gray-400">No entries</td></tr>`; return; }

                list.sort((a,b) => new Date(b.Date) - new Date(a.Date)).forEach(r => {
                    const isInc = r.Txn_Type === 'Income';
                    const tr = document.createElement('tr');
                    tr.className = "hover:bg-red-50/30 border-b border-gray-100 last:border-0 transition";
                    tr.innerHTML = `
                        <td class="p-3 text-xs text-gray-500 whitespace-nowrap">${r.Date}</td>
                        <td class="p-3">
                            <div class="font-bold text-slate-800 text-xs">${r.Particulars}</div>
                            <div class="text-[10px] text-gray-400">${r.Category}</div>
                        </td>
                        <td class="p-3 text-right font-mono font-bold text-xs ${isInc ? 'text-green-700' : 'text-red-700'}">
                            ${isInc ? '+' : '-'}₹${Number(r.Amount).toLocaleString()}
                        </td>
                        <td class="p-3 text-center text-xs">
                             ${r.Doc_Link ? `<a href="${r.Doc_Link}" target="_blank" class="text-blue-600 hover:underline"><i class="fas fa-paperclip"></i></a>` : '-'}
                        </td>
                        <td class="p-3 text-right">
                             <button onclick='accounts.openModal("edit", ${JSON.stringify(r).replace(/'/g, "&#39;")})' class="text-gray-400 hover:text-red-700 transition"><i class="fas fa-edit"></i></button>
                        </td>
                    `;
                    tbody.appendChild(tr);
                });
            },
            openModal: (mode, data = null) => {
                document.getElementById('form-account').reset();
                document.getElementById('Date').valueAsDate = new Date();
                document.getElementById('modal-account').classList.remove('hidden');
                if(mode === 'add') {
                    document.getElementById('acc-modal-title').innerText = "New Transaction";
                    document.getElementById('a-rowIndex').value = "";
                } else {
                    document.getElementById('acc-modal-title').innerText = "Edit Transaction";
                    document.getElementById('a-rowIndex').value = data.rowIndex;
                    Object.keys(data).forEach(k => { 
                        if(document.getElementById(k)) document.getElementById(k).value = (k === 'Date' && data[k] ? data[k].split('T')[0] : data[k]); 
                    });
                    if(data.Client_Name) document.getElementById('a-Client_Name').value = data.Client_Name;
                }
            },
            closeModal: () => document.getElementById('modal-account').classList.add('hidden')
        };

        // SEARCH
        document.getElementById('search-clients').addEventListener('input', (e) => {
            const t = e.target.value.toLowerCase();
            clients.render(clients.data.filter(c => c.Client_Name.toLowerCase().includes(t) || c.Client_ID.toLowerCase().includes(t)));
        });
        document.getElementById('search-accounts').addEventListener('input', (e) => {
            const t = e.target.value.toLowerCase();
            accounts.render(accounts.data.filter(a => a.Particulars.toLowerCase().includes(t) || (a.Client_Name && a.Client_Name.toLowerCase().includes(t))));
        });

        // FORMS
        document.getElementById('form-client').addEventListener('submit', async (e) => {
            e.preventDefault();
            const btn = document.getElementById('c-save-btn');
            btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Saving...'; btn.disabled = true;
            const fd = new FormData(e.target); const obj = Object.fromEntries(fd.entries());
            obj.action = obj.rowIndex ? "editClient" : "addClient";
            obj.rowIndex = document.getElementById('c-rowIndex').value;
            
            try {
                await fetch(API_URL, { method: 'POST', body: JSON.stringify(obj) });
                clients.closeModal(); clients.data = []; clients.init();
            } catch(err) { alert('Error saving client'); } finally { btn.innerHTML = 'Save Client'; btn.disabled = false; }
        });

        document.getElementById('form-account').addEventListener('submit', async (e) => {
            e.preventDefault();
            const btn = document.getElementById('a-save-btn');
            btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Saving...'; btn.disabled = true;
            const fd = new FormData(e.target); const obj = Object.fromEntries(fd.entries());
            obj.action = obj.rowIndex ? "editTransaction" : "addTransaction";
            obj.rowIndex = document.getElementById('a-rowIndex').value;

            try {
                await fetch(API_URL, { method: 'POST', body: JSON.stringify(obj) });
                accounts.closeModal(); accounts.data = []; accounts.init();
            } catch(err) { alert('Error saving transaction'); } finally { btn.innerHTML = 'Save Transaction'; btn.disabled = false; }
        });

    </script>
</body>
</html>
